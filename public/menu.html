<!doctype html>
<html>
	<head>
		<link rel="stylesheet" href="css/index.css">
		<link rel="stylesheet" href="js/qunit/qunit-1.16.0.css">
		<style>
			html, body{
				margin: 0px;
				padding: 0px;
			}
			#menu{
				background-color: #ffa500;
				width: 600px;
				 height:600px;
				 display: flex;
				 flex-direction: column;
			}
			h1{
				color: #FFFF00;
				height: 10%;
			}

			h1:hover{
				cursor: default;
			}

			h1, p{
				font-family: 'Lucida Console';
				font-weight: bold;
				text-align: center;
				font-size: 50px;
				margin: 0px;
				padding: 0px;
			}
			#menus{
				height: 90%;
				display: flex;
				flex-direction: column;
			}
			.contenedor{
				margin: 20px;
				background-color: #0000FF;
				color: #FFFFFF;
				padding: 3%;
				height: 100%;
				cursor: pointer;
				/*border: 10px solid white;*/
			}

			.contenedor:hover{
				background-color: #190477;
			}

			.contenedor p{
				margin: auto;
				/*border: 10px solid green;*/
			}
		</style>
		<script>
			function loadAudio(url){
				return new Promise((resolve)=>{
					let audio = new Audio();
					//El evento en el tipo "Audio" es 'loadeddata'
					audio.addEventListener('loadeddata',()=>resolve(audio), true);
					audio.src=url;
				});
			}
			window.onload=function(){
				// Cargar sonidos en variables globales
				loadAudio("./res/audio/game_over.wav").then( audio => game_over = audio);
				loadAudio("./res/audio/finish_level.wav").then( audio => finish_level = audio);
				loadAudio("./res/audio/hit_wall.wav").then( audio => hit_wall = audio);
				loadAudio("./res/audio/pacman_dead.wav").then( audio => pacman_dead = audio);
				loadAudio("./res/audio/pellet.wav").then( audio => pellet = audio);
				loadAudio("./res/audio/power_pellet.wav").then( audio => power_pellet = audio);
				loadAudio("./res/audio/finish_vulnerable.wav").then( audio => finish_vulnerable = audio);
				loadAudio("./res/audio/ghost_dead.wav").then( audio => ghost_dead = audio);
				
				console.log("Iniciado");
				let contenedores = document.getElementsByClassName("contenedor");
				document.getElementById("jugar").addEventListener("click", jugar, true);
				document.getElementById("multijugador_local").addEventListener("click", multijugadorLocal, true);
				document.getElementById("online").addEventListener("click", function(){
					result = window.prompt("Nombre de la sala");
					document.getElementById("menu").style="display: none";
					var newurl = window.location.protocol + "//" + window.location.host + window.location.pathname + '?online=true';
    				window.history.pushState({path:newurl},'',newurl);
					
					var game = new GF();
					game.start();
					//loadAudio("./res/audio/fondo.mp3").then( audio => {audio.volume = 0.15; audio.play();});
				},true);
				document.getElementById("acercade").addEventListener("click", function(){
					alert("Créditos");
					//TODO Créditos de musica
					/*
					"Your Call" Kevin MacLeod (incompetech.com)
					Licensed under Creative Commons: By Attribution 4.0 License
					http://creativecommons.org/licenses/by/4.0/
					*/
				},true);
			};

			function jugar(){
				//console.log("jugar");
				//loadAudio("./res/audio/fondo.mp3").then( audio => audio.play());
				//window.location.href="index.html";
				document.getElementById("menu").style="display: none";
				var game = new GF();
				game.start();
				loadAudio("./res/audio/fondo.mp3").then( audio => {audio.volume = 0.15; audio.play();});
			}

			function multijugadorLocal(){
				document.getElementById("menu").style="display: none";
				var newurl = window.location.protocol + "//" + window.location.host + window.location.pathname + '?numJugadores=2';
    			window.history.pushState({path:newurl},'',newurl);
				var game = new GF();
				game.start();
				loadAudio("./res/audio/fondo.mp3").then( audio => {audio.volume = 0.15; audio.play();});
			}
		</script>
	</head>
	<body bgcolor="black">
		<div id="menu">
			<h1>Pacman</h1>
			<div id="menus">
				<div class="contenedor" id="jugar"><p>Play</p></div>
				<div class="contenedor" id="multijugador_local"><p>2-player</p></div>
				<div class="contenedor" id="online"><p>Online</p></div>
				<div class="contenedor" id="acercade"><p>About</p></div>
			</div>
			
		</div>
		<canvas id="canvas" width="600" height="600"></canvas>
		<p>
		<script type="text/javascript" src="/socket.io/socket.io.js"></script>
		<script src="js/sprite.js"></script>
		<script src="js/resources.js"></script>
		<script src="js/howler.js"></script>
		<script src="js/modular/pantallas.js"></script>
		<script src="js/modular/sockets.js"></script>
		<script src="js/pacman.js"></script>
	</body>
</html>